# Join Pfam descriptions and create new label
top_domains <- pfam_stats %>%
  slice_min(padj, n = 15) %>%
  left_join(pfam_annotated %>% select(Pfam, Description) %>% distinct(), by = "Pfam") %>%
  mutate(
    label = paste(Pfam, "-", Description),
    label = fct_reorder(label, fold_enrichment),
    log_padj = -log10(padj)
  )

# Plot
ggplot(top_domains, aes(x = fold_enrichment, y = label)) +
  geom_point(aes(size = deg_count, color = log_padj)) +
  scale_color_gradient(low = "steelblue", high = "firebrick") +
  labs(
    title = "Top 15 Enriched Pfam Domains in DEGs",
    x = "Fold Enrichment",
    y = "Pfam Domain",
    size = "# DEGs",
    color = "-log10(FDR-adjusted p-value)"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 9),
    plot.title = element_text(face = "bold", hjust = 0.5)
  )


top_domains <- pfam_stats %>%
  slice_min(padj, n = 15) %>%
  left_join(pfam_annotated %>% select(Pfam, Description) %>% distinct(), by = "Pfam") %>%
  mutate(
    Description = str_replace_na(Description, "Unknown"),
    Description = str_remove(Description, "^.*?;"),
    Description = str_remove(Description, "anon.*"),
    Description = str_remove(Description, ":.*"),
    Description = str_trim(Description),
    label = paste(Pfam, "-", Description),
    label = fct_reorder(label, fold_enrichment),
    log_padj = -log10(padj)
  )


# Plot
ggplot(top_domains, aes(x = fold_enrichment, y = label)) +
  geom_point(aes(size = deg_count, color = log_padj)) +
  scale_color_gradient(low = "steelblue", high = "firebrick") +
  labs(
    title = "Top 15 Enriched Pfam Domains in DEGs",
    x = "Fold Enrichment",
    y = "Pfam Domain",
    size = "# DEGs",
    color = "-log10(FDR-adjusted p-value)"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 9),
    plot.title = element_text(face = "bold", hjust = 0.5)
  )


